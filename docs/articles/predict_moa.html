<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predict compounds mechanism-of-action by morphological profiling â€¢ cytominergallery</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">cytominergallery</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/predict_moa_using_snf.html">Improving predicting compounds mechanism-of-action by morphological profiling using SNF</a>
    </li>
    <li>
      <a href="../articles/predict_moa.html">Predict compounds mechanism-of-action by morphological profiling</a>
    </li>
    <li>
      <a href="../articles/single_cell_analysis.html">Analyze single-cell data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cytomining/cytominergallery">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Predict compounds mechanism-of-action by morphological profiling</h1>
                        <h4 class="author">Allen Goodman and Shantanu Singh</h4>
            
            <h4 class="date">2017-10-03</h4>
          </div>

    
    
<div class="contents">
<p>This vignette demonstrates predicting compound mechanism-of-action using morphological profiling data. See the vignette <code>single_cell_analysis</code> for details about this dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(cytominergallery)</code></pre></div>
<div id="load-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load data</h1>
<p>Per-well profiles computed in <code>single_cell_analysis</code> are loaded, as well as metadata associated with these profiles (obtained from <a href="https://data.broadinstitute.org/bbbc/BBBC021/">BBBC021</a>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles &lt;-
<span class="st">  </span>readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"ljosa_jbiomolscreen_2013_per_well_mean.csv"</span>,
                <span class="dt">package =</span> <span class="st">"cytominergallery"</span>))

moa &lt;-
<span class="st">  </span>readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"BBBC021_v1_moa.csv"</span>,
                              <span class="dt">package =</span> <span class="st">"cytominergallery"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">Image_Metadata_Compound =</span> compound,
                <span class="dt">Image_Metadata_Concentration =</span> concentration,
                <span class="dt">Image_Metadata_MoA =</span> moa
  )

metadata &lt;-
<span class="st">  </span>readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"BBBC021_v1_image.csv"</span>,
                              <span class="dt">package =</span> <span class="st">"cytominergallery"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">Image_Metadata_Plate =</span> Image_Metadata_Plate_DAPI,
                <span class="dt">Image_Metadata_Well =</span> Image_Metadata_Well_DAPI
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/select_helpers.html">matches</a></span>(<span class="st">"^Image_Metadata"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(moa) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()

profiles <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(metadata)

variables &lt;-
<span class="st">  </span><span class="kw">colnames</span>(profiles) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_subset">str_subset</a></span>(<span class="st">"^Nuclei_|^Cells_|^Cytoplasm_"</span>)</code></pre></div>
<p>How many compounds?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Image_Metadata_Compound <span class="op">!=</span><span class="st"> "DMSO"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(Image_Metadata_Compound) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">tally</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="st">`</span><span class="dt">Number of compounds</span><span class="st">`</span> =<span class="st"> </span>n) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Number of compounds</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">38</td>
</tr></tbody>
</table>
<p>How many unique treatments (compound-concentration pairs)?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Image_Metadata_Compound <span class="op">!=</span><span class="st"> "DMSO"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(Image_Metadata_Compound, Image_Metadata_Concentration) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">tally</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="st">`</span><span class="dt">Number of unique treatments</span><span class="st">`</span> =<span class="st"> </span>n) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Number of unique treatments</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">103</td>
</tr></tbody>
</table>
<p>How many replicates per unique treatment?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Image_Metadata_Compound <span class="op">!=</span><span class="st"> "DMSO"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">count</a></span>(Image_Metadata_Compound, Image_Metadata_Concentration) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="st">`</span><span class="dt">Number of replicates</span><span class="st">`</span> =<span class="st"> </span>n) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Image_Metadata_Compound</th>
<th align="right">Image_Metadata_Concentration</th>
<th align="right">Number of replicates</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ALLN</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">ALLN</td>
<td align="right">100.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">alsterpaullone</td>
<td align="right">1.000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">alsterpaullone</td>
<td align="right">3.000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">anisomycin</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">anisomycin</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-A</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-A</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-A</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-A</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-A</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-A</td>
<td align="right">30.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-C</td>
<td align="right">0.001</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-C</td>
<td align="right">0.003</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-C</td>
<td align="right">0.010</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-C</td>
<td align="right">0.030</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-C</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-C</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-C</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-J</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-J</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-J</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-U</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ-U</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ-U</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ138</td>
<td align="right">0.030</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ138</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ138</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ138</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ138</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ258</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ258</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ258</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ841</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">AZ841</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">AZ841</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">bryostatin</td>
<td align="right">0.300</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">camptothecin</td>
<td align="right">0.003</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">camptothecin</td>
<td align="right">0.010</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">camptothecin</td>
<td align="right">0.030</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">chlorambucil</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">cisplatin</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">colchicine</td>
<td align="right">0.030</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">cyclohexamide</td>
<td align="right">5.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">cyclohexamide</td>
<td align="right">15.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">cyclohexamide</td>
<td align="right">50.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">cytochalasin B</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">cytochalasin B</td>
<td align="right">30.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">cytochalasin D</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">demecolcine</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">demecolcine</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">demecolcine</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">demecolcine</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">docetaxel</td>
<td align="right">0.030</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">docetaxel</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">docetaxel</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">emetine</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">emetine</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">emetine</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">epothilone B</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">epothilone B</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">epothilone B</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">etoposide</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">etoposide</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">etoposide</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">floxuridine</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">floxuridine</td>
<td align="right">30.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">lactacystin</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">latrunculin B</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">latrunculin B</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">methotrexate</td>
<td align="right">10.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">mevinolin/lovastatin</td>
<td align="right">1.500</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">mevinolin/lovastatin</td>
<td align="right">5.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">mevinolin/lovastatin</td>
<td align="right">15.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">MG-132</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">MG-132</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">mitomycin C</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">mitomycin C</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">mitomycin C</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">mitomycin C</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">mitoxantrone</td>
<td align="right">0.003</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">mitoxantrone</td>
<td align="right">0.010</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">nocodazole</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">nocodazole</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">PD-169316</td>
<td align="right">3.000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">PD-169316</td>
<td align="right">10.000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">PP-2</td>
<td align="right">3.000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">PP-2</td>
<td align="right">10.000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">proteasome inhibitor I</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">proteasome inhibitor I</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">simvastatin</td>
<td align="right">2.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">simvastatin</td>
<td align="right">6.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">simvastatin</td>
<td align="right">20.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">taxol</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">taxol</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">taxol</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">vincristine</td>
<td align="right">0.003</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">vincristine</td>
<td align="right">0.010</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">vincristine</td>
<td align="right">0.030</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">vincristine</td>
<td align="right">0.100</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">vincristine</td>
<td align="right">0.300</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">vincristine</td>
<td align="right">1.000</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">vincristine</td>
<td align="right">3.000</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>How many DMSO wells per plate?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Image_Metadata_Compound <span class="op">==</span><span class="st"> "DMSO"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/tally.html">count</a></span>(Image_Metadata_Plate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="st">`</span><span class="dt">Number of DMSO wells</span><span class="st">`</span> =<span class="st"> </span>n) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Image_Metadata_Plate</th>
<th align="right">Number of DMSO wells</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Week1_22123</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week1_22141</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week1_22161</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week1_22361</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week1_22381</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week1_22401</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week10_40111</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week10_40115</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week10_40119</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week2_24121</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week2_24141</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week2_24161</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week2_24361</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week2_24381</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week2_24401</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week3_25421</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week3_25441</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week3_25461</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week3_25681</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week3_25701</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week3_25721</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week4_27481</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week4_27521</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week4_27542</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week4_27801</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week4_27821</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week4_27861</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week5_28901</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week5_28921</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week5_28961</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week5_29301</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week5_29321</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week5_29341</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week6_31641</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week6_31661</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week6_31681</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week6_32061</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week6_32121</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week6_32161</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week7_34341</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week7_34381</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week7_34641</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week7_34661</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week7_34681</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week8_38203</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week8_38221</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week8_38241</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week8_38341</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week8_38342</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week9_39206</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week9_39221</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week9_39222</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week9_39282</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Week9_39283</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Week9_39301</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
<div id="feature-selection" class="section level1">
<h1 class="hasAnchor">
<a href="#feature-selection" class="anchor"></a>Feature selection</h1>
<p>Next, lets filter the set of features based on various measures of quality</p>
<p>Remove features that have near-zero variance. This dataset doesnâ€™t have any such features, so nothing is removed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles &lt;-
<span class="st">  </span>cytominer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cytominer/topics/variable_select">variable_select</a></span>(
    <span class="dt">population =</span> profiles,
    <span class="dt">variables =</span> variables,
    <span class="dt">sample =</span> profiles,
    <span class="dt">operation =</span> <span class="st">"variance_threshold"</span>
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/compute.html">collect</a></span>()

variables &lt;-
<span class="st">  </span><span class="kw">colnames</span>(profiles) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_subset">str_subset</a></span>(<span class="st">"^Nuclei_|^Cells_|^Cytoplasm_"</span>)</code></pre></div>
<p>Remove features that have poor correlation across replicates. To do so, lets first compute the correlations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">doParallel<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doParallel/topics/registerDoParallel">registerDoParallel</a></span>(<span class="dt">cores =</span> <span class="dv">2</span>)

feature_replicate_correlations &lt;-
<span class="st">  </span>profiles <span class="op">%&gt;%</span>
<span class="st">  </span>cytominer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cytominer/topics/variable_importance">variable_importance</a></span>(
    <span class="dt">variables =</span> variables,
    <span class="dt">strata =</span> <span class="kw">c</span>(<span class="st">"Image_Metadata_Compound"</span>, <span class="st">"Image_Metadata_Concentration"</span>),
    <span class="dt">replicates =</span> <span class="dv">3</span>,
    <span class="dt">cores =</span> <span class="dv">2</span>)</code></pre></div>
<p>What the does the distribution look like?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(feature_replicate_correlations, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(median))  <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/stat_ecdf">stat_ecdf</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_vline</a></span>(<span class="dt">xintercept =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="st">"red"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"median replicate correlation (Pearson)"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"F(x)"</span>)</code></pre></div>
<p><img src="predict_moa_files/figure-html/unnamed-chunk-8-1.png" width="384"></p>
<p>Here, we select a threshold and remove features that have a replicate correlation lower than that threshold</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/se-deprecated.html">select_</a></span>(<span class="dt">.dots =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span>(<span class="dt">x =</span> <span class="kw">colnames</span>(profiles),
                          <span class="dt">y =</span> feature_replicate_correlations <span class="op">%&gt;%</span>
<span class="st">                            </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(median <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>) <span class="op">%&gt;%</span>
<span class="st">                            </span>magrittr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="st">"variable"</span>))
          )

variables &lt;-
<span class="st">  </span><span class="kw">colnames</span>(profiles) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_subset">str_subset</a></span>(<span class="st">"^Nuclei_|^Cells_|^Cytoplasm_"</span>)</code></pre></div>
<p>Filter based on correlation between features. The morphological features extracted contain several highly correlated groups. We want to to prune the set of features, retaining only one feature from each of these highly correlated sets. The function <code>correlation_threshold</code> provides an approximate (greedy) solution to this problem. After excluding the features, no pair of features have a correlation greater than <code>cutoff</code> indicated below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles &lt;-
<span class="st">  </span>cytominer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cytominer/topics/variable_select">variable_select</a></span>(
    <span class="dt">population =</span> profiles,
    <span class="dt">variables =</span> variables,
    <span class="dt">sample =</span> profiles,
    <span class="dt">operation =</span> <span class="st">"correlation_threshold"</span>,
    <span class="dt">cutoff =</span> <span class="fl">0.95</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/compute.html">collect</a></span>()</code></pre></div>
<pre><code>## INFO [2017-10-03 20:19:35] excluded:
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MaximumRadius
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MeanRadius
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MedianRadius
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MinFeretDiameter
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MinorAxisLength
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MaxIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MaxIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MeanIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MeanIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MeanIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MedianIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MedianIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MinIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_StdIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_StdIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_StdIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_StdIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_UpperQuartileIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_UpperQuartileIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_NumberOfNeighbors_3
## INFO [2017-10-03 20:19:35]    Cells_Texture_SumVariance_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_Variance_CorrActin_10_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_Variance_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_Variance_CorrTub_10_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_Area
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MajorAxisLength
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MaxFeretDiameter
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MaximumRadius
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MeanRadius
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MedianRadius
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MinFeretDiameter
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_MinorAxisLength
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_Solidity
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_Zernike_0_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_IntegratedIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_IntegratedIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_IntegratedIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MADIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MADIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MassDisplacement_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MassDisplacement_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MaxIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MaxIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MaxIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MeanIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MeanIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MeanIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MeanIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MedianIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MedianIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MinIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MinIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MinIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MinIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_StdIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_StdIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_StdIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_StdIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_UpperQuartileIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_UpperQuartileIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_DifferenceEntropy_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_DifferenceVariance_CorrTub_10_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_DifferenceVariance_CorrTub_3_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_InfoMeas2_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_SumAverage_CorrTub_3_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_Variance_CorrTub_10_0
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_MajorAxisLength
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_MaxFeretDiameter
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_MeanRadius
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_MinorAxisLength
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Perimeter
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_3_3
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_4_4
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_5_3
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_6_6
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_7_3
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_7_5
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_7_7
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_9_7
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_9_9
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_IntegratedIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_IntegratedIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_IntegratedIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_IntegratedIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_LowerQuartileIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_LowerQuartileIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MADIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MADIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MaxIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MaxIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MaxIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MaxIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MeanIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MeanIntensityEdge_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MeanIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MeanIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MeanIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MeanIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MedianIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MedianIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MedianIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MinIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MinIntensityEdge_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MinIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MinIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MinIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_StdIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_StdIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_StdIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_StdIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_UpperQuartileIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_UpperQuartileIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_UpperQuartileIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Nuclei_Neighbors_PercentTouching_10
## INFO [2017-10-03 20:19:35]    Nuclei_Texture_InfoMeas2_CorrDAPI_3_0
## INFO [2017-10-03 20:19:35]    Nuclei_Texture_Variance_CorrDAPI_3_0
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_Area
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MajorAxisLength
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_MaxFeretDiameter
## INFO [2017-10-03 20:19:35]    Cells_Intensity_LowerQuartileIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MADIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MaxIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MinIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MADIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_AngleBetweenNeighbors_10
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_FirstClosestDistance_10
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_NumberOfNeighbors_10
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_SecondClosestDistance_10
## INFO [2017-10-03 20:19:35]    Cells_Texture_Contrast_CorrTub_10_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_InfoMeas1_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_SumVariance_CorrTub_3_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_AreaShape_Extent
## INFO [2017-10-03 20:19:35]    Cells_AreaShape_Perimeter
## INFO [2017-10-03 20:19:35]    Cells_Intensity_IntegratedIntensity_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MeanIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Intensity_LowerQuartileIntensity_CorrTub
## INFO [2017-10-03 20:19:35]    Cytoplasm_Intensity_MaxIntensityEdge_CorrTub
## INFO [2017-10-03 20:19:35]    Cells_Intensity_MaxIntensityEdge_CorrActin
## INFO [2017-10-03 20:19:35]    Cells_Texture_AngularSecondMoment_CorrTub_3_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_Contrast_CorrActin_10_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_DifferenceVariance_CorrActin_10_0
## INFO [2017-10-03 20:19:35]    Cells_Texture_DifferenceEntropy_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Cytoplasm_Texture_AngularSecondMoment_CorrTub_10_0
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_MaximumRadius
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_MedianRadius
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_3_1
## INFO [2017-10-03 20:19:35]    Nuclei_AreaShape_Zernike_5_5
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MADIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MaxIntensityEdge_CorrDAPI
## INFO [2017-10-03 20:19:35]    Nuclei_Intensity_MaxIntensity_CorrDAPI
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_AngleBetweenNeighbors_3
## INFO [2017-10-03 20:19:35]    Nuclei_Neighbors_AngleBetweenNeighbors_10
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_FirstClosestDistance_3
## INFO [2017-10-03 20:19:35]    Nuclei_Neighbors_FirstClosestDistance_10
## INFO [2017-10-03 20:19:35]    Cells_Neighbors_SecondClosestDistance_3
## INFO [2017-10-03 20:19:35]    Nuclei_Neighbors_SecondClosestDistance_10
## INFO [2017-10-03 20:19:35]    Nuclei_Texture_AngularSecondMoment_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Nuclei_Texture_InfoMeas1_CorrActin_10_0
## INFO [2017-10-03 20:19:35]    Nuclei_Texture_InfoMeas1_CorrActin_3_0
## INFO [2017-10-03 20:19:35]    Nuclei_Texture_InfoMeas1_CorrTub_3_0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">variables &lt;-
<span class="st">  </span><span class="kw">colnames</span>(profiles) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_subset">str_subset</a></span>(<span class="st">"^Nuclei_|^Cells_|^Cytoplasm_"</span>)</code></pre></div>
</div>
<div id="normalize-with-reference-to-dmso" class="section level1">
<h1 class="hasAnchor">
<a href="#normalize-with-reference-to-dmso" class="anchor"></a>Normalize with reference to DMSO</h1>
<p>There may be plate-to-plate variations, which can be compensated for to some extent by normalizing the features with respect to the DMSO wells per plate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles &lt;-
<span class="st">  </span>cytominer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cytominer/topics/normalize">normalize</a></span>(
    <span class="dt">population =</span> profiles,
    <span class="dt">variables =</span> variables,
    <span class="dt">strata =</span>  <span class="kw">c</span>(<span class="st">"Image_Metadata_Plate"</span>),
    <span class="dt">sample =</span> profiles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Image_Metadata_Compound <span class="op">==</span><span class="st"> "DMSO"</span>)
  )

profiles &lt;-
<span class="st">  </span>cytominer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cytominer/topics/variable_select">variable_select</a></span>(
      <span class="dt">population =</span> profiles,
      <span class="dt">variables =</span> variables,
      <span class="dt">operation =</span> <span class="st">"drop_na_columns"</span>
  )

variables &lt;-
<span class="st">  </span><span class="kw">colnames</span>(profiles) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_subset">str_subset</a></span>(<span class="st">"^Nuclei_|^Cells_|^Cytoplasm_"</span>)</code></pre></div>
</div>
<div id="calculate-treatment-profiles-and-predict-mechanism-of-action" class="section level1">
<h1 class="hasAnchor">
<a href="#calculate-treatment-profiles-and-predict-mechanism-of-action" class="anchor"></a>Calculate treatment profiles and predict mechanism-of-action</h1>
<p>We have selected features and normalized the data. We can now compute treatment profiles by averaging across replicates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles &lt;-
<span class="st">  </span>cytominer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cytominer/topics/aggregate">aggregate</a></span>(
    <span class="dt">population =</span> profiles,
    <span class="dt">variables =</span> variables,
    <span class="dt">strata =</span> <span class="kw">c</span>(<span class="st">"Image_Metadata_Compound"</span>,
               <span class="st">"Image_Metadata_Concentration"</span>,
               <span class="st">"Image_Metadata_MoA"</span>),
    <span class="dt">operation =</span> <span class="st">"mean"</span>
  )

variables &lt;-
<span class="st">  </span><span class="kw">colnames</span>(profiles) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_subset">str_subset</a></span>(<span class="st">"^Nuclei_|^Cells_|^Cytoplasm_"</span>)</code></pre></div>
<p>Letâ€™s visualize this data using t-SNE.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profiles <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Image_Metadata_Compound <span class="op">!=</span><span class="st"> "DMSO"</span>)

correlation &lt;-
<span class="st">  </span>profiles <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/select_helpers.html">one_of</a></span>(variables)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cor</span>()

mechanism &lt;-<span class="st"> </span><span class="kw">as.character</span>(profiles<span class="op">$</span>Image_Metadata_MoA)

<span class="kw">set.seed</span>(<span class="dv">123</span>)

df &lt;-
<span class="st">  </span>tibble<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tibble/topics/as_tibble">as_data_frame</a></span>(
    tsne<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tsne/topics/tsne">tsne</a></span>(<span class="kw">as.dist</span>(<span class="dv">1</span><span class="op">-</span>correlation))
    ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">mechanism =</span> mechanism)

p &lt;-
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(V1, V2, <span class="dt">color=</span>mechanism)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"t-SNE visualization of compound profiles"</span>)

<span class="kw">print</span>(p)</code></pre></div>
<p><img src="predict_moa_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>The data clusters into mechanisms quite nicely. Letâ€™s quantify this by evaluating how well we can predict mechanism-of-action by simply assigning a treatment the mechanism of its nearest neighbor. NOTE: A common mistake when analyzing this dataset is to not exclude other concentrations of the same compound when looking up the nearest neighbor. That is cheating! <code>mask</code> in the code below addresses this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">compound &lt;-<span class="st"> </span>profiles<span class="op">$</span>Image_Metadata_Compound

mask &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">outer</span>(compound, compound, <span class="dt">FUN=</span><span class="st">"!="</span>))

mask[mask <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="op">-</span><span class="ot">Inf</span>

correlation_masked &lt;-<span class="st"> </span>correlation <span class="op">*</span><span class="st"> </span>mask

prediction &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(correlation_masked),
               <span class="cf">function</span>(i) mechanism[<span class="kw">order</span>(correlation_masked[i,],
                                           <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span>]])

confusion_matrix &lt;-<span class="st"> </span>caret<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/caret/topics/confusionMatrix">confusionMatrix</a></span>(prediction, mechanism)</code></pre></div>
<p>Whatâ€™s the classification accuracy?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tibble<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tibble/topics/tribble">frame_data</a></span>(
  <span class="op">~</span>metric, <span class="op">~</span>value,
  <span class="st">"Accuracy"</span>, <span class="kw">sprintf</span>(<span class="st">"%.2f"</span>, confusion_matrix<span class="op">$</span>overall[<span class="st">"Accuracy"</span>]),
  <span class="st">"95% CI"</span>, <span class="kw">sprintf</span>(<span class="st">"(%.2f, %.2f)"</span>, confusion_matrix<span class="op">$</span>overall[[<span class="st">"AccuracyLower"</span>]],
                    confusion_matrix<span class="op">$</span>overall[[<span class="st">"AccuracyUpper"</span>]])
  ) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">metric</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Accuracy</td>
<td align="left">0.82</td>
</tr>
<tr class="even">
<td align="left">95% CI</td>
<td align="left">(0.73, 0.89)</td>
</tr>
</tbody>
</table>
<p>What does the whole confusion matrix look like?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">confusion_matrix<span class="op">$</span>table <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">Actin disruptors</th>
<th align="right">Aurora kinase inhibitors</th>
<th align="right">Cholesterol-lowering</th>
<th align="right">DNA damage</th>
<th align="right">DNA replication</th>
<th align="right">Eg5 inhibitors</th>
<th align="right">Epithelial</th>
<th align="right">Kinase inhibitors</th>
<th align="right">Microtubule destabilizers</th>
<th align="right">Microtubule stabilizers</th>
<th align="right">Protein degradation</th>
<th align="right">Protein synthesis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Actin disruptors</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>Aurora kinase inhibitors</td>
<td align="right">0</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>Cholesterol-lowering</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>DNA damage</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>DNA replication</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>Eg5 inhibitors</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>Epithelial</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>Kinase inhibitors</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>Microtubule destabilizers</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>Microtubule stabilizers</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>Protein degradation</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>Protein synthesis</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-data">Load data</a></li>
      <li><a href="#feature-selection">Feature selection</a></li>
      <li><a href="#normalize-with-reference-to-dmso">Normalize with reference to DMSO</a></li>
      <li><a href="#calculate-treatment-profiles-and-predict-mechanism-of-action">Calculate treatment profiles and predict mechanism-of-action</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tim Becker, Allen Goodman, Claire McQuin, Mohammad Rohban, Shantanu Singh.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
